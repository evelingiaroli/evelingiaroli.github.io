<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>R 2017</title>
<meta name="author" content="(Luis G. Moyano)"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="../../reveal.js/css/reveal.css"/>

<link rel="stylesheet" href="../../reveal.js/css/theme/my_moon.css" id="theme"/>

<link rel="stylesheet" href="../../reveal.js/lib/css/zenburn.css"/>
<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = '../../reveal.js/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
<meta name="description" content="Programación en R 2017">
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide"><h1>R 2017</h1><h3>09/05/2017</h3>
</section>

<section>
<section id="slide-orgb1ce354">
<h2 id="orgb1ce354">emma habla de caret</h2>
</section>
</section>
<section>
<section id="slide-org6de1d7a">
<h2 id="org6de1d7a">repaso de la clase anterior</h2>
<div class="outline-text-2" id="text-org6de1d7a">
</div></section>
<section id="slide-orgb93eaba">
<h3 id="orgb93eaba">RStudio</h3>
<ul>
<li><p>
Working directory / Workspace
</p>
<div class="org-src-container">

<pre><code class="R" >getwd() # para saber donde estoy
setwd("path/to/dir") # para decirle donde quiero estar
</code></pre>
</div></li>
<li>Proyectos: Conjunto de archivos que van juntos: miproyecto.Rproj, .RData, .Rsession, etc</li>
<li>Cómo grabo lo que hago?</li>

</ul>
<ol class="smallfont">
  <li>abrir un proyecto nuevo y grabar después</li>
  <li>grabar en algún directorio y después decirle que haga un proyecto ahí</li>
  <li>sin proyectos, gestionar todo uno mismo (no muy recomendado)</li>
</ol>
<aside class="notes">
<ul>
<li><a href="https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects">https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects</a></li>
<li>Usen atajos de teclado! Ver machete de RStudio (cheatsheet) en Slack</li>

</ul>

</aside>

</section>
<section id="slide-org9722504">
<h3 id="org9722504">Funciones</h3>
<aside class="notes">
<p>
Una función tiene como propósito encapsular y automatizar tareas que se repetirón, posiblemente 
sobre objetos distintos cada vez. Por ejemplo, la función `read_csv` o `plot` contiene código que no
querríamos escribir cada vez que queremos cargar datos de un archivo csv o hacer un gráfico. A su
vez, con ellas podemos cargar datos de cualquier archivo csv o hacer cualquier gráfico.
</p>

<p>
Más información en <a href="http://r4ds.had.co.nz/functions.html">http://r4ds.had.co.nz/functions.html</a>.
</p>

</aside>

<div class="org-src-container">

<pre><code class="R" ># mi función se llama alta_funcion, con dos argumentos
alta_funcion <- function(arg1 = 10, arg2 = TRUE, ...){

  # acá empieza mi código
  library(paquete_externo)
  x <- funcion_externa(arg_ext = arg1) 
  ...
  alto código
  código y más código
  ...
  alto_resultado <- mansa_funcion(arg2) # genero alto_resultado

  return(alto_resultado) # devuelvo alto resultado
}
</code></pre>
</div>

<div class="org-src-container">

<pre><code class="R" ># llamo a mi función de distintas maneras
x_default <- alta_funcion() # uso arg1 = 10 y arg2 = TRUE
x_100_F   <- alta_funcion(100, FALSE)
x_200_T   <- alta_funcion(200, TRUE)
mi_var    <- alta_funcion(arg2 = FALSE, arg_ext = 10.2) # uso arg1 = 10
</code></pre>
</div>

</section>
</section>
<section>
<section id="slide-orgd855007" data-background="#123456">
<h2 id="orgd855007">repaso de la práctica 5</h2>
<p>
Trabajamos sobre datos de ruido de Buenos Aires Data. 
</p>

<ol>
<li><p>
Escribir una función que devuelva el min, máx y promedio (mean) del ruido dependiendo del barrio
</p>
<div class="org-src-container">

<pre><code class="R" >myf <- function() {
   min  <- summarise(group_by(ruido_bsas, BARRIO), em = min(PROMEDIO_ENERGETICO_HORA, na.rm = TRUE))
   mean <- summarise(group_by(ruido_bsas, BARRIO), em = mean(PROMEDIO_ENERGETICO_HORA, na.rm = TRUE))
   max  <- summarise(group_by(ruido_bsas, BARRIO), em = max(PROMEDIO_ENERGETICO_HORA, na.rm = TRUE))
   return(list(min, mean, max)) # return(c(min, mean, max)) #
} 
</code></pre>
</div></li>

<li><p>
Porqué obtengo un <code>NA</code> en los resultados de la práctica anterior?
</p>
<div class="org-src-container">

<pre><code class="R" ># there are many empty measures
which(is.na(ruido_bsas$PROMEDIO_ENERGETICO_HORA))
# or, alternatively
m2013 %>% group_by(PROMEDIO_ENERGETICO_HORA) %>% summarise(n()) %>% print( n = Inf ) # 2011, 2012 también tienen
# and also, some TMIs in measures are missing in reference table (2012 and 2013)
missing2011 <- m2011$TMI %>% unique %in% tmi$TMI
tmi[which(!missing2011), ]
missing2012 <- m2012$TMI %>% unique %in% tmi$TMI
tmi[which(!missing2012), ]
missing2013 <- m2013$TMI %>% unique %in% tmi$TMI
tmi[which(!missing2013), ]
# which ones? 
anti_join(ruido_bsas, tmi, by = "TMI" ) %>% select(TMI) %>% unique()

</code></pre>
</div>

<ol>
<li>Usar lo aprendido sobre joins para no tener este <code>NA</code></li>

</ol>
<div class="org-src-container">

<pre><code class="R" >ruido_bsas_inner <- inner_join(ruido_bsas, tmi)
ruido_barrios_inner <- ruido_bsas_inner %>% group_by(BARRIO) %>% summarise(ruido_avg = mean(PROMEDIO_ENERGETICO_HORA, na.rm = TRUE)) %>% arrange(desc(ruido_avg))
</code></pre>
</div></li>
<li><p>
Cómo puedo mejorar la columna FECHA de la práctica 3? Consejo: usar el paquete <code>stringr</code> más <code>tidyr::separate</code>
</p>
<div class="org-src-container">

<pre><code class="R" >expanded_ruido_bsas <- ruido_bsas_inner %>% separate(FECHA, into = c("date", "h"), sep = " ") %>% separate(date, into = c("d", "m", "y"), sep = "/")
</code></pre>
</div></li>
<li><p>
Cuál es la hora de mayor ruido del día? Cuál es el dia más ruidoso de la semana? Hay algún barrio
con mucho más ruido durante el fin de semana que el resto?
</p>
<div class="org-src-container">

<pre><code class="R" ># hora del dia de más ruido
summarise(group_by(expanded_ruido_bsas, h), mh = mean(PROMEDIO_ENERGETICO_HORA, na.rm = TRUE)) %>% arrange(desc(mh))

# dia más ruidoso de la semana  
semi_ruido_bsas <- ruido_bsas_inner %>% separate(FECHA, into = c("date", "h"), sep = " ") 
daily_em <- summarise(group_by(semi_ruido_bsas, date), me = mean(PROMEDIO_ENERGETICO_HORA, na.rm = TRUE))
daily_em_unique <- summarise( group_by( daily_em, date ), me = mean( me ) ) %>% separate(date, into = c("d", "m", "y"), sep = "/") %>% arrange( y, m, d)

# 275 dias de 2011, 366 de 2012 y 212 de 2013, 853 dias en total
# los datos empiezan el 1 de abril de 2011, un Viernes
week <- c("Vie", "Sab", "Dom", "Lun", "Mar", "Mie", "Jue")
wday <- tbl_df(rep(week, 122)[1:853]) # alternativamente dos concatenates, c(rep(week, 121),  c("Vie", "Sab", "Dom", "Lun", "Mar", "Mie"))
names(wday) <- "wday"

daily_em_unique <- bind_cols(daily_em_unique, wday)
summarise( group_by(daily_em_unique, wday), me_wday = mean(me, na.rm = TRUE))

# cuidado con las mediciones 
## semi_ruido_bsas %>% group_by(date) %>% separate(date, into = c("d", "m", "y"), sep = "/") %>% filter(y == '2013', m == '01') 
## semi_ruido_bsas %>% group_by(date) %>% separate(date, into = c("d", "m", "y"), sep = "/") %>% filter(y == '2013', m == '02') 
## semi_ruido_bsas %>% group_by(date) %>% separate(date, into = c("d", "m", "y"), sep = "/") %>% filter(y == '2013', m == '08') 
</code></pre>
</div></li>

</ol>
</section>
</section>
<section>
<section id="slide-org85cebab">
<h2 id="org85cebab">'Types': tipos de datos</h2>
<ul>
<li>'logical':    TRUE o FALSE</li>
<li>'integer':    naturales: &#x2026;, -1, 0, 1, &#x2026;</li>
<li>'double':    irracionales: 3.1415926</li>
<li>'character':    alfanuméricos: "pi"</li>
<li>'complex':    1+i10</li>
<li>'raw':     48 65 6c 6c 6f</li>

</ul>
</section>
<section id="slide-org89589aa">
<h3 id="org89589aa">logical</h3>
<div class="org-src-container">

<pre><code class="R" >v <- TRUE 
print(class(v))
</code></pre>
</div>
</section>
<section id="slide-org8af00c0">
<h3 id="org8af00c0">integer</h3>
<div class="org-src-container">

<pre><code class="R" >v <- 2L
print(class(v))
</code></pre>
</div>
</section>
<section id="slide-org007c82c">
<h3 id="org007c82c">double</h3>
<div class="org-src-container">

<pre><code class="R" >v <- 23.5
print(class(v))
</code></pre>
</div>
</section>
<section id="slide-org3f6ab4f">
<h3 id="org3f6ab4f">character</h3>
<div class="org-src-container">

<pre><code class="R" >v <- "TRUE" # v <- "Maldad pura"
print(class(v))
</code></pre>
</div>
</section>
<section id="slide-org7e241d2">
<h3 id="org7e241d2">complex</h3>
<div class="org-src-container">

<pre><code class="R" >v <- 2+5i
print(class(v))
</code></pre>
</div>
</section>
<section id="slide-org177f064">
<h3 id="org177f064">raw</h3>
<div class="org-src-container">

<pre><code class="R" >v <- charToRaw("Hello")
print(class(v))
</code></pre>
</div>
</section>
</section>
<section>
<section id="slide-org69c17e6">
<h2 id="org69c17e6">Vectores</h2>
<ol>
<li>Vectores 'atómicos' (<i>atomic vectors</i>), de los cuales hay 6 tipos
<ul>
<li>'logical', 'integer', 'double', 'character', 'complex' y 'raw'.</li>
<li>Integer y double son tratados como 'numeric'</li>

</ul></li>

<li>'Listas'
<ul>
<li>Pueden a su vez contener listas (vectores recursivos)</li>

</ul></li>

</ol>

<aside class="notes">
<p>
La principal diferencia entre los vectores atómicos y las listas es que son homogeneos, mientras que
las listas no. Hay un objeto relacionado, 'NULL', que es la ausencia de un vector (NA es la ausencia
de un valor de un vector). NULL se puede tratar como un vector de largo 0.
</p>

</aside>

<img style="WIDTH:350px; HEIGHT:300px; border:0"  src="./figs/data-structures-overview.png">
</section>
</section>
<section>
<section id="slide-orgfbc644f">
<h2 id="orgfbc644f">Propiedades de vectores</h2>
<ol>
<li>Su tipo (type), que se determina con <i>typeof()</i></li>

</ol>

<div class="org-src-container">

<pre><code class="R" >typeof(letters)
#> [1] "character"
typeof(1:10)
#> [1] "integer"
</code></pre>
</div>

<ol>
<li>Su largo (length), que se determina con <i>length()</i></li>

</ol>
<div class="org-src-container">

<pre><code class="R" >x <- list("a", "b", 1:10)
length(x)
#> [1] 3
</code></pre>
</div>

<ol>
<li>Atributos: vectores "aumentados"
<ul>
<li>Factores, construidos sobre vectores 'integer'</li>
<li>Dates y date-times, sobre vectores 'numeric'</li>
<li>Data frames (y tibbles) sobre listas</li>

</ul></li>

</ol>
</section>
</section>
</div>
</div>
<p> @luisgmoyano </p>
<script src="../../reveal.js/lib/js/head.min.js"></script>
<script src="../../reveal.js/js/reveal.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: false,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
overview: true,
margin: 0.10,
minScale: 0.50,
maxScale: 2.50,

theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
transition: Reveal.getQueryHash().transition || 'slide', // default/cube/page/concave/zoom/linear/fade/none
transitionSpeed: 'fast',
multiplex: {
    secret: '', // null if client
    id: '', // id, obtained from socket.io server
    url: '' // Location of socket.io server
},

// Optional libraries used to extend on reveal.js
dependencies: [
 { src: '../../reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }]
});
</script>
</body>
</html>
